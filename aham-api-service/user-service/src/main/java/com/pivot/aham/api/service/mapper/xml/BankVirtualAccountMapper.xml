<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pivot.aham.api.service.mapper.BankVirtualAccountMapper">

    <resultMap id="bamkVirtualAccountMap" type="com.pivot.aham.api.service.mapper.model.BankVirtualAccount">
        <id column="id" property="id"/>
        <result column="client_id" property="clientId"/>
        <result column="client_name" property="clientName"/>
        <result column="virtual_account_no" property="virtualAccountNo"/>
        <result column="cash_amount" property="cashAmount"/>
        <result column="freeze_amount" property="freezeAmount"/>
        <result column="used_amount" property="usedAmount"/>
        <result column="currency" property="currency"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <!--<result column="redeem_apply_id" property="redeemApplyId"/>-->
    </resultMap>

    <sql id="base_column">
        id, client_id, client_name, virtual_account_no, cash_amount, freeze_amount, used_amount, currency, update_time, create_time
    </sql>

    <insert id="saveBankVirtualAccount" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_bank_virtual_account (
        <trim suffixOverrides=",">
            <if test="@Ognl@isNotEmpty(id)">
                id,
            </if>
            <if test="@Ognl@isNotEmpty(clientId)">
                client_id,
            </if>
            <if test="@Ognl@isNotEmpty(clientName)">
                client_name,
            </if>
            <if test="@Ognl@isNotEmpty(virtualAccountNo)">
                virtual_account_no,
            </if>
            <if test="@Ognl@isNotEmpty(cashAmount)">
                cash_amount,
            </if>
            <if test="@Ognl@isNotEmpty(freezeAmount)">
                freeze_amount,
            </if>
            <if test="@Ognl@isNotEmpty(usedAmount)">
                used_amount,
            </if>
            <if test="@Ognl@isNotEmpty(currency)">
                currency,
            </if>
            <if test="@Ognl@isNotEmpty(createTime)">
                create_time,
            </if>
            <if test="@Ognl@isNotEmpty(updateTime)">
                update_time,
            </if>
        </trim>
        ) VALUES (
        <trim suffixOverrides=",">
            <if test="@Ognl@isNotEmpty(id)">
                #{id},
            </if>
            <if test="@Ognl@isNotEmpty(clientId)">
                #{clientId},
            </if>
            <if test="@Ognl@isNotEmpty(clientName)">
                #{clientName},
            </if>
            <if test="@Ognl@isNotEmpty(virtualAccountNo)">
                #{virtualAccountNo},
            </if>
            <if test="@Ognl@isNotEmpty(cashAmount)">
                #{cashAmount},
            </if>
            <if test="@Ognl@isNotEmpty(freezeAmount)">
                #{freezeAmount},
            </if>
            <if test="@Ognl@isNotEmpty(usedAmount)">
                #{usedAmount},
            </if>
            <if test="@Ognl@isNotEmpty(currency)">
                #{currency},
            </if>
            <if test="@Ognl@isNotEmpty(createTime)">
                #{createTime},
            </if>
            <if test="@Ognl@isNotEmpty(updateTime)">
                #{updateTime},
            </if>
        </trim>
        )
    </insert>

    <insert id="saveBatch" parameterType="java.util.List">
        INSERT INTO t_bank_virtual_account
        (
        id,
        client_id,
        client_name,
        virtual_account_no,
        cash_amount,
        freeze_amount,
        used_amount,
        currency,
        update_time,
        create_time
        ) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.id},
            #{item.clientId},
            #{item.clientName},
            #{item.virtualAccountNo},
            #{item.cashAmount},
            #{item.freezeAmount},
            #{item.usedAmount},
            #{item.currency},
            #{item.createTime},
            #{item.updateTime}
            )
        </foreach>
    </insert>

    <update id="updateBankVirtualAccount">
        UPDATE t_bank_virtual_account
        <set>
            <if test="@Ognl@isNotEmpty(cashAmount)">
                cash_amount = #{cashAmount},
            </if>
            <if test="@Ognl@isNotEmpty(freezeAmount)">
                freeze_amount = #{freezeAmount},
            </if>
            <if test="@Ognl@isNotEmpty(usedAmount)">
                used_amount = #{usedAmount},
            </if>
            <if test="@Ognl@isNotEmpty(currency)">
                currency = #{currency},
            </if>
            <if test="@Ognl@isNotEmpty(updateTime)">
                update_time = #{updateTime},
            </if>
        </set>
        <where>
            id = #{id}
        </where>
    </update>

    <select id="quaryBankVirtualAccount" resultMap="bamkVirtualAccountMap">
        SELECT
        <include refid="base_column"/>
        FROM t_bank_virtual_account
        <where>
            <if test="@Ognl@isNotEmpty(clientId)">
                client_id=#{clientId}
            </if>
            <if test="@Ognl@isNotEmpty(clientName)">
                and clent_name=#{clientName}
            </if>
            <if test="@Ognl@isNotEmpty(virtualAccountNo)">
                and virtual_account_no=#{virtualAccountNo}
            </if>
            <if test="@Ognl@isNotEmpty(currency)">
                and currency=#{currency}
            </if>
        </where>
    </select>

    <select id="queryListByVirtualAccounts" resultMap="bamkVirtualAccountMap">
        SELECT
        <include refid="base_column"/>
        FROM t_bank_virtual_account
        WHERE virtual_account_no in
        <foreach collection="virtualAccountIds" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="queryListBankVirtualAccount" resultMap="bamkVirtualAccountMap">
        SELECT
        <include refid="base_column"/>
        FROM t_bank_virtual_account
        <where>
            <if test="@Ognl@isNotEmpty(clientId)">
                and client_id=#{clientId}
            </if>
            <if test="@Ognl@isNotEmpty(currency)">
                and currency=#{currency}
            </if>
            <if test="@Ognl@isNotEmpty(virtualAccountNo)">
                and virtual_account_no=#{virtualAccountNo}
            </if>

        </where>
        order by id asc;
    </select>

    <select id="getListByTradeTime" parameterType="map" resultMap="bamkVirtualAccountMap">
        SELECT
        <include refid="base_column"/>
        FROM t_bank_virtual_account
        WHERE
        1=1
        <if test="@Ognl@isNotEmpty(startTime) and @Ognl@isNotEmpty(endTime) ">
            AND update_time BETWEEN #{startTime} AND #{endTime}
        </if>
    </select>
    
    <select id="queryBankVirtualAccDescByCurrency" resultMap="bamkVirtualAccountMap">
        SELECT
        <include refid="base_column"/>
        FROM t_bank_virtual_account
        <where>
            <if test="@Ognl@isNotEmpty(currency)">
                currency=#{currency}
            </if>
        </where>
        order by virtual_account_no desc limit 1;
    </select>


</mapper>
