<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pivot.aham.api.service.mapper.UserProfitInfoMapper">

    <resultMap id="UserProfitInfoRes" type="com.pivot.aham.api.service.mapper.model.UserProfitInfoPO">
        <result property="id" column="id"></result>
        <result property="clientId" column="client_id"></result>
        <result property="accountId" column="account_id"></result>
        <result property="goalId" column="goal_id"></result>
        <result property="totalProfit" column="total_profit"></result>
        <result property="portfolioProfit" column="portfolio_profit"></result>
        <result property="fxImpact" column="fx_impact"></result>
        <result property="profitDate" column="profit_date"></result>
        <result property="createTime" column="create_time"></result>
        <result property="updateTime" column="update_time"></result>
    </resultMap>

    <sql id="baseColum">
        id,
        client_id,
        account_id,
        goal_id,
        total_profit,
        portfolio_profit,
        fx_impact,
        `profit_date`,
        create_time,
        update_time
    </sql>

    <insert id="saveUserProfit" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_user_profit_info (
        <trim suffixOverrides=",">
            <if test="@Ognl@isNotEmpty(id)">
                id,
            </if>
            <if test="@Ognl@isNotEmpty(clientId)">
                client_id,
            </if>
            <if test="@Ognl@isNotEmpty(accountId)">
                account_id,
            </if>
            <if test="@Ognl@isNotEmpty(goalId)">
                goal_id,
            </if>
            <if test="@Ognl@isNotEmpty(totalProfit)">
                total_profit,
            </if>
            <if test="@Ognl@isNotEmpty(portfolioProfit)">
                portfolio_profit,
            </if>
            <if test="@Ognl@isNotEmpty(fxImpact)">
                fx_impact,
            </if>
            <if test="@Ognl@isNotEmpty(profitDate)">
                `profit_date`,
            </if>
            <if test="@Ognl@isNotEmpty(createTime)">
                create_time,
            </if>
            <if test="@Ognl@isNotEmpty(updateTime)">
                update_time
            </if>
        </trim>
        ) VALUES (
        <trim suffixOverrides=",">
            <if test="@Ognl@isNotEmpty(id)">
                #{id},
            </if>
            <if test="@Ognl@isNotEmpty(clientId)">
                #{clientId},
            </if>
            <if test="@Ognl@isNotEmpty(accountId)">
                #{accountId},
            </if>
            <if test="@Ognl@isNotEmpty(goalId)">
                #{goalId},
            </if>
            <if test="@Ognl@isNotEmpty(totalProfit)">
                #{totalProfit},
            </if>
            <if test="@Ognl@isNotEmpty(portfolioProfit)">
                #{portfolioProfit},
            </if>
            <if test="@Ognl@isNotEmpty(fxImpact)">
                #{fxImpact},
            </if>
            <if test="@Ognl@isNotEmpty(profitDate)">
                #{profitDate},
            </if>
            <if test="@Ognl@isNotEmpty(createTime)">
                #{createTime},
            </if>
            <if test="@Ognl@isNotEmpty(updateTime)">
                #{updateTime}
            </if>
        </trim>
        )
    </insert>

    <insert id="saveBatch" parameterType="java.util.List">
        INSERT INTO t_user_profit_info
        (
        id,
        client_id,
        account_id,
        goal_id,
        total_profit,
        portfolio_profit,
        fx_impact,
        `profit_date`,
        create_time,
        update_time
        ) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.id},
            #{item.clientId},
            #{item.accountId},
            #{item.goalId},
            #{item.totalProfit},
            #{item.portfolioProfit},
            #{item.fxImpact},
            #{item.profitDate},
            #{item.createTime},
            #{item.updateTime}
            )
        </foreach>
    </insert>

    <update id="updateUserProfit">
        UPDATE t_user_profit_info
        <set>
            <if test="@Ognl@isNotEmpty(totalProfit)">
                total_profit=#{totalProfit},
            </if>
            <if test="@Ognl@isNotEmpty(portfolioProfit)">
                portfolio_profit=#{portfolioProfit},
            </if>
            <if test="@Ognl@isNotEmpty(fxImpact)">
                fx_impact=#{fxImpact},
            </if>
            <if test="@Ognl@isNotEmpty(profitDate)">
                `profit_date`=#{profitDate},
            </if>
            <if test="@Ognl@isNotEmpty(updateTime)">
                update_time=#{updateTime},
            </if>
        </set>
        <where>
            id=#{id}
        </where>
    </update>

    <select id="selectOneByTime" resultMap="UserProfitInfoRes">
        SELECT
        <include refid="baseColum"/>
        FROM t_user_profit_info
        <where>
            <if test="@Ognl@isNotEmpty(accountId)">
                and account_id = #{accountId}
            </if>
            <if test="@Ognl@isNotEmpty(clientId)">
                and client_id = #{clientId}
            </if>
            <if test="@Ognl@isNotEmpty(goalId)">
                and goal_id = #{goalId}
            </if>
            <if test="@Ognl@isNotEmpty(profitDate)">
                and DATE_FORMAT(`profit_date`,'%Y-%m-%d')=DATE_FORMAT(#{profitDate},'%Y-%m-%d')
            </if>
        </where>
    </select>

    <select id="listByGoalds" resultMap="UserProfitInfoRes">
        SELECT
        <include refid="baseColum"/>
        FROM t_user_profit_info
        <where>
            goal_id in
            <foreach collection="goalIds" item="item" index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            <if test="@Ognl@isNotEmpty(profitDate)">
                and DATE_FORMAT(`profit_date`,'%Y-%m-%d')=DATE_FORMAT(#{profitDate},'%Y-%m-%d')
            </if>
        </where>
    </select>


    <select id="queryProfitList" resultMap="UserProfitInfoRes">
        SELECT
        <include refid="baseColum"/>
        FROM t_user_profit_info
        <where>
            <if test="@Ognl@isNotEmpty(accountId)">
                and account_id = #{accountId}
            </if>
            <if test="@Ognl@isNotEmpty(clientId)">
                and client_id = #{clientId}
            </if>
            <if test="@Ognl@isNotEmpty(goalId)">
                and goal_id = #{goalId}
            </if>
            <if test="@Ognl@isNotEmpty(profitDate)">
                and DATE_FORMAT(`profit_date`,'%Y-%m-%d')=DATE_FORMAT(#{profitDate},'%Y-%m-%d')
            </if>
        </where>
    </select>

</mapper>
